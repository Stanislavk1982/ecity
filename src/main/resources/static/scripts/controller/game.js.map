{"version":3,"sources":["../../../source/scripts/controller/game.js"],"names":["define","Superagent","Settings","Q","Game","loggedIn","gameId","gameStatus","prototype","getGameId","defer","get","host","api","set","end","error","response","console","log","body","length","JSON","parse","text","id","triggerChangeGameId","resolve","reject","promise","logIn","user","password","auth","type","logOut","isLoggedIn","onChangeGameId","callback","callbacks","push","offChangeGameId","filter","cb","forEach"],"mappings":"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","file":"game.js","sourcesContent":["define(['superagent', '../settings', 'q'], function (Superagent, Settings, Q) {\n\n    var Game = function(){\n          this.loggedIn = false;\n          this.gameId = 0;\n          this.gameStatus = false;\n    };\n\n    Game.prototype.getGameId = function(){\n        var defer = Q.defer();\n\n        Superagent\n                .get(Settings.host + Settings.api + '/game/new')\n                .set('Accept', 'application/json')\n                .end((error, response) => /* arrow function */{\n                    console.log(error);\n                    if(!error || response.body.length > 0){\n                        this.gameId = JSON.parse(response.text).id;\n                        console.log(this.gameId);\n\n                        // Tell all listeners that game id changed\n                        this.triggerChangeGameId();\n\n                        defer.resolve();\n                    } else {\n                        defer.reject();\n                    }\n                });\n            return defer.promise;\n    };\n\n    Game.prototype.logIn = function(user, password){\n        var defer = Q.defer();\n\n        Superagent\n            .get(Settings.host + Settings.api + '/user/hello')\n            .set('Accept', 'application/json')\n            .auth(user, password, {type:'auto'})\n            .end((error, response) => /* arrow function */{\n                console.log(error);\n                if(!error || response.body.length > 0){\n                    this.loggedIn = true;\n                    defer.resolve();\n                } else {\n                    this.loggedIn = false;\n                    defer.reject();\n                }\n            });\n        Superagent\n            .get(Settings.host + Settings.api + '/game/status')\n            .set('Accept', 'application/json')\n            .end((error, response) => /* arrow function */{\n                this.gameId = JSON.parse(response.text).id;\n                console.log(this.gameId);\n            });\n\n        return defer.promise;\n    };\n\n    Game.prototype.logOut = function(){\n        this.loggedIn = false;\n    };\n\n    Game.prototype.isLoggedIn = function(){\n        return this.loggedIn;\n    };\n\n    Game.prototype.onChangeGameId = function (callback) {\n        if (!this.callbacks) {\n            this.callbacks = [];\n        }\n\n        this.callbacks.push(callback);\n    };\n\n    Game.prototype.offChangeGameId = function (callback) {\n        if (!this.callbacks) {\n            return;\n        }\n\n\n        this.callbacks = this.callbacks.filter(cb => {\n            return cb !== callback;\n        });\n        \n    };\n\n    Game.prototype.triggerChangeGameId = function () {\n        if (!this.callbacks) {\n            return;\n        }\n\n        this.callbacks.forEach(callback => {\n            callback(this.gameId);\n        });\n    };\n\n    return Game;\n});\n"]}